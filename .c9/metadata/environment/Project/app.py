{"filter":false,"title":"app.py","tooltip":"/Project/app.py","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":117,"column":0},"end":{"row":117,"column":4},"action":"remove","lines":["    "],"id":706},{"start":{"row":118,"column":0},"end":{"row":118,"column":4},"action":"remove","lines":["    "]},{"start":{"row":119,"column":0},"end":{"row":119,"column":4},"action":"remove","lines":["    "]},{"start":{"row":120,"column":0},"end":{"row":120,"column":4},"action":"remove","lines":["    "]},{"start":{"row":121,"column":0},"end":{"row":121,"column":4},"action":"remove","lines":["    "]},{"start":{"row":122,"column":0},"end":{"row":122,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":117,"column":0},"end":{"row":122,"column":1},"action":"remove","lines":["s3 = boto3.client(","    service_name=\"s3\",","    region_name=S3_BUCKET_REGION,","    aws_access_key_id=S3_ACCESS_KEY,","    aws_secret_access_key=S3_SECRET_ACCESS_KEY",")"],"id":707},{"start":{"row":116,"column":63},"end":{"row":117,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":55,"column":0},"end":{"row":61,"column":15},"action":"remove","lines":["","def find_directory_with_prefix(bucket_name, prefix):","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix, Delimiter='/')","    for common_prefix in response.get('CommonPrefixes', []):","        directory_path = common_prefix['Prefix']","        return directory_path","    return None"],"id":708}],[{"start":{"row":55,"column":0},"end":{"row":56,"column":0},"action":"insert","lines":["",""],"id":709}],[{"start":{"row":56,"column":0},"end":{"row":61,"column":15},"action":"insert","lines":["def find_directory_with_prefix(bucket_name, prefix):","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix, Delimiter='/')","    for common_prefix in response.get('CommonPrefixes', []):","        directory_path = common_prefix['Prefix']","        return directory_path","    return None"],"id":710}],[{"start":{"row":56,"column":0},"end":{"row":61,"column":15},"action":"remove","lines":["def find_directory_with_prefix(bucket_name, prefix):","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix, Delimiter='/')","    for common_prefix in response.get('CommonPrefixes', []):","        directory_path = common_prefix['Prefix']","        return directory_path","    return None"],"id":711},{"start":{"row":56,"column":0},"end":{"row":69,"column":15},"action":"insert","lines":["# S3 client creation","s3 = boto3.client(","    service_name=\"s3\",","    region_name=S3_BUCKET_REGION,","    aws_access_key_id=S3_ACCESS_KEY,","    aws_secret_access_key=S3_SECRET_ACCESS_KEY",")","","def find_directory_with_prefix(bucket_name, prefix):","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix, Delimiter='/')","    for common_prefix in response.get('CommonPrefixes', []):","        directory_path = common_prefix['Prefix']","        return directory_path","    return None"]}],[{"start":{"row":124,"column":0},"end":{"row":142,"column":21},"action":"remove","lines":["def get_file_names_from_directory(bucket_name, directory_path):","    file_names = []","    ","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=directory_path)","    for obj in response.get('Contents', []):","        file_name = obj['Key'].split('/')[-1]","        file_names.append(file_name)","    return file_names","","# mojji-output-img 디렉터리와 동일한 디렉터리를 찾음","s3_directory_path = find_directory_with_prefix('mojji-output-img', 'mojji-output-img')","","if s3_directory_path is None:","    print(\"Directory with prefix '{}' not found in the S3 bucket.\".format('mojji-output-img'))","else:","    # 해당 디렉터리 내의 파일 이름 추출","    file_names = get_file_names_from_directory('mojji-output-img', s3_directory_path)","    print(\"File names in the directory '{}':\".format(s3_directory_path))","    print(file_names)"],"id":712}],[{"start":{"row":124,"column":0},"end":{"row":141,"column":21},"action":"insert","lines":["def get_file_names_from_directory(bucket_name, directory_path):","    file_names = []","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=directory_path)","    for obj in response.get('Contents', []):","        file_name = obj['Key'].split('/')[-1]","        file_names.append(file_name)","    return file_names","","# mojji-output-img directory and its contents","s3_directory_path = find_directory_with_prefix(S3_BUCKET_NAME, S3_DIRECTORY_PREFIX)","","if s3_directory_path is None:","    print(\"Directory with prefix '{}' not found in the S3 bucket.\".format(S3_DIRECTORY_PREFIX))","else:","    # Extract file names from the directory","    file_names = get_file_names_from_directory(S3_BUCKET_NAME, s3_directory_path)","    print(\"File names in the directory '{}':\".format(s3_directory_path))","    print(file_names)"],"id":713}],[{"start":{"row":133,"column":47},"end":{"row":133,"column":61},"action":"remove","lines":["S3_BUCKET_NAME"],"id":714},{"start":{"row":133,"column":47},"end":{"row":133,"column":65},"action":"insert","lines":["'mojji-output-img'"]}],[{"start":{"row":133,"column":67},"end":{"row":133,"column":86},"action":"remove","lines":["S3_DIRECTORY_PREFIX"],"id":715},{"start":{"row":133,"column":67},"end":{"row":133,"column":85},"action":"insert","lines":["'mojji-output-img'"]}],[{"start":{"row":136,"column":74},"end":{"row":136,"column":93},"action":"remove","lines":["S3_DIRECTORY_PREFIX"],"id":718},{"start":{"row":136,"column":74},"end":{"row":136,"column":92},"action":"insert","lines":["'mojji-output-img'"]}],[{"start":{"row":139,"column":47},"end":{"row":139,"column":61},"action":"remove","lines":["S3_BUCKET_NAME"],"id":719},{"start":{"row":139,"column":47},"end":{"row":139,"column":65},"action":"insert","lines":["'mojji-output-img'"]}],[{"start":{"row":57,"column":0},"end":{"row":57,"column":2},"action":"insert","lines":["# "],"id":720},{"start":{"row":58,"column":0},"end":{"row":58,"column":2},"action":"insert","lines":["# "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":2},"action":"insert","lines":["# "]},{"start":{"row":60,"column":0},"end":{"row":60,"column":2},"action":"insert","lines":["# "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":2},"action":"insert","lines":["# "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":2},"action":"insert","lines":["# "]},{"start":{"row":64,"column":0},"end":{"row":64,"column":2},"action":"insert","lines":["# "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":2},"action":"insert","lines":["# "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":2},"action":"insert","lines":["# "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":2},"action":"insert","lines":["# "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":2},"action":"insert","lines":["# "]},{"start":{"row":69,"column":0},"end":{"row":69,"column":2},"action":"insert","lines":["# "]},{"start":{"row":71,"column":0},"end":{"row":71,"column":2},"action":"insert","lines":["# "]},{"start":{"row":72,"column":0},"end":{"row":72,"column":2},"action":"insert","lines":["# "]},{"start":{"row":73,"column":0},"end":{"row":73,"column":2},"action":"insert","lines":["# "]},{"start":{"row":74,"column":0},"end":{"row":74,"column":2},"action":"insert","lines":["# "]},{"start":{"row":75,"column":0},"end":{"row":75,"column":2},"action":"insert","lines":["# "]},{"start":{"row":76,"column":0},"end":{"row":76,"column":2},"action":"insert","lines":["# "]},{"start":{"row":77,"column":0},"end":{"row":77,"column":2},"action":"insert","lines":["# "]},{"start":{"row":78,"column":0},"end":{"row":78,"column":2},"action":"insert","lines":["# "]},{"start":{"row":80,"column":0},"end":{"row":80,"column":2},"action":"insert","lines":["# "]},{"start":{"row":82,"column":0},"end":{"row":82,"column":2},"action":"insert","lines":["# "]},{"start":{"row":83,"column":0},"end":{"row":83,"column":2},"action":"insert","lines":["# "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":2},"action":"insert","lines":["# "]},{"start":{"row":87,"column":0},"end":{"row":87,"column":2},"action":"insert","lines":["# "]},{"start":{"row":88,"column":0},"end":{"row":88,"column":2},"action":"insert","lines":["# "]},{"start":{"row":89,"column":0},"end":{"row":89,"column":2},"action":"insert","lines":["# "]},{"start":{"row":91,"column":0},"end":{"row":91,"column":2},"action":"insert","lines":["# "]},{"start":{"row":92,"column":0},"end":{"row":92,"column":2},"action":"insert","lines":["# "]},{"start":{"row":94,"column":0},"end":{"row":94,"column":2},"action":"insert","lines":["# "]},{"start":{"row":96,"column":0},"end":{"row":96,"column":2},"action":"insert","lines":["# "]},{"start":{"row":98,"column":0},"end":{"row":98,"column":2},"action":"insert","lines":["# "]},{"start":{"row":99,"column":0},"end":{"row":99,"column":2},"action":"insert","lines":["# "]},{"start":{"row":100,"column":0},"end":{"row":100,"column":2},"action":"insert","lines":["# "]},{"start":{"row":102,"column":0},"end":{"row":102,"column":2},"action":"insert","lines":["# "]},{"start":{"row":103,"column":0},"end":{"row":103,"column":2},"action":"insert","lines":["# "]},{"start":{"row":104,"column":0},"end":{"row":104,"column":2},"action":"insert","lines":["# "]},{"start":{"row":105,"column":0},"end":{"row":105,"column":2},"action":"insert","lines":["# "]},{"start":{"row":106,"column":0},"end":{"row":106,"column":2},"action":"insert","lines":["# "]},{"start":{"row":107,"column":0},"end":{"row":107,"column":2},"action":"insert","lines":["# "]},{"start":{"row":108,"column":0},"end":{"row":108,"column":2},"action":"insert","lines":["# "]},{"start":{"row":110,"column":0},"end":{"row":110,"column":2},"action":"insert","lines":["# "]},{"start":{"row":111,"column":0},"end":{"row":111,"column":2},"action":"insert","lines":["# "]},{"start":{"row":112,"column":0},"end":{"row":112,"column":2},"action":"insert","lines":["# "]},{"start":{"row":113,"column":0},"end":{"row":113,"column":2},"action":"insert","lines":["# "]},{"start":{"row":114,"column":0},"end":{"row":114,"column":2},"action":"insert","lines":["# "]},{"start":{"row":116,"column":0},"end":{"row":116,"column":2},"action":"insert","lines":["# "]},{"start":{"row":117,"column":0},"end":{"row":117,"column":2},"action":"insert","lines":["# "]},{"start":{"row":119,"column":0},"end":{"row":119,"column":2},"action":"insert","lines":["# "]},{"start":{"row":120,"column":0},"end":{"row":120,"column":2},"action":"insert","lines":["# "]},{"start":{"row":121,"column":0},"end":{"row":121,"column":2},"action":"insert","lines":["# "]},{"start":{"row":122,"column":0},"end":{"row":122,"column":2},"action":"insert","lines":["# "]},{"start":{"row":124,"column":0},"end":{"row":124,"column":2},"action":"insert","lines":["# "]},{"start":{"row":125,"column":0},"end":{"row":125,"column":2},"action":"insert","lines":["# "]},{"start":{"row":126,"column":0},"end":{"row":126,"column":2},"action":"insert","lines":["# "]},{"start":{"row":127,"column":0},"end":{"row":127,"column":2},"action":"insert","lines":["# "]},{"start":{"row":128,"column":0},"end":{"row":128,"column":2},"action":"insert","lines":["# "]},{"start":{"row":129,"column":0},"end":{"row":129,"column":2},"action":"insert","lines":["# "]},{"start":{"row":130,"column":0},"end":{"row":130,"column":2},"action":"insert","lines":["# "]},{"start":{"row":132,"column":0},"end":{"row":132,"column":2},"action":"insert","lines":["# "]},{"start":{"row":133,"column":0},"end":{"row":133,"column":2},"action":"insert","lines":["# "]},{"start":{"row":135,"column":0},"end":{"row":135,"column":2},"action":"insert","lines":["# "]},{"start":{"row":136,"column":0},"end":{"row":136,"column":2},"action":"insert","lines":["# "]},{"start":{"row":137,"column":0},"end":{"row":137,"column":2},"action":"insert","lines":["# "]},{"start":{"row":138,"column":0},"end":{"row":138,"column":2},"action":"insert","lines":["# "]},{"start":{"row":139,"column":0},"end":{"row":139,"column":2},"action":"insert","lines":["# "]},{"start":{"row":140,"column":0},"end":{"row":140,"column":2},"action":"insert","lines":["# "]},{"start":{"row":141,"column":0},"end":{"row":141,"column":2},"action":"insert","lines":["# "]}],[{"start":{"row":142,"column":88},"end":{"row":143,"column":0},"action":"insert","lines":["",""],"id":721}],[{"start":{"row":143,"column":0},"end":{"row":217,"column":0},"action":"insert","lines":["import os","import boto3","from flask import Flask, render_template, request","","app = Flask(__name__)","","# S3 bucket configuration","S3_BUCKET_REGION = 'your_bucket_region'","S3_ACCESS_KEY = 'your_access_key'","S3_SECRET_ACCESS_KEY = 'your_secret_access_key'","S3_BUCKET_NAME = 'your_bucket_name'","S3_DIRECTORY_PREFIX = 'mojji-output-img'","","# S3 client creation","s3 = boto3.client(","    service_name=\"s3\",","    region_name=S3_BUCKET_REGION,","    aws_access_key_id=S3_ACCESS_KEY,","    aws_secret_access_key=S3_SECRET_ACCESS_KEY",")","","def find_directory_with_prefix(bucket_name, prefix):","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=prefix, Delimiter='/')","    for common_prefix in response.get('CommonPrefixes', []):","        directory_path = common_prefix['Prefix']","        return directory_path","    return None","","def get_file_names_from_directory(bucket_name, directory_path):","    file_names = []","    response = s3.list_objects_v2(Bucket=bucket_name, Prefix=directory_path)","    for obj in response.get('Contents', []):","        file_name = obj['Key'].split('/')[-1]","        file_names.append(file_name)","    return file_names","","@app.route('/user_check', methods=['GET'])","def user_check():","    # Get the value of identifier from the query parameters","    identifier = request.args.get('identifier', '')","    oauth_code = request.args.get('oauth_code', '')","    directory_name_split = request.args.get('directory_name_split', '')","    image_code = request.args.get('code', '')","    ","    prefix = 'after_detection_'","","    # Define the base directory path","    # base_directory = '/home/ubuntu/environment/efs/mojji-output-img/'","    ","    directory_with_prefix = find_directory_with_prefix(S3_BUCKET_NAME, prefix)","","    if directory_with_prefix is None:","        # If the directory with the prefix is not found, handle the error","        return \"Directory with prefix '{}' not found.\".format(prefix)","","    # Construct the full identifier with the directory name","    full_identifier = os.path.join(directory_with_prefix)","","    object_names = get_file_names_from_directory(S3_BUCKET_NAME, full_identifier)","","    # You can use the code to generate the S3 URL for the uploaded image","    result_url = s3.generate_presigned_url(","        'get_object',","        Params={'Bucket': \"resultimg\", 'Key': image_code},","        ExpiresIn=3600  # URL's expiration time in seconds","    )","    ","    # Pass the object names, directory name, and identifier to the template","    return render_template('page5.html', code=image_code, object_names=object_names,","                           directory_name=directory_name_split, identifier=identifier,","                           oauth_code=oauth_code, result_url=result_url, full_identifier=full_identifier)","","if __name__ == '__main__':","    app.run(debug=True)",""],"id":722}],[{"start":{"row":216,"column":23},"end":{"row":217,"column":0},"action":"remove","lines":["",""],"id":723},{"start":{"row":216,"column":22},"end":{"row":216,"column":23},"action":"remove","lines":[")"]},{"start":{"row":216,"column":21},"end":{"row":216,"column":22},"action":"remove","lines":["e"]},{"start":{"row":216,"column":20},"end":{"row":216,"column":21},"action":"remove","lines":["u"]},{"start":{"row":216,"column":19},"end":{"row":216,"column":20},"action":"remove","lines":["r"]},{"start":{"row":216,"column":18},"end":{"row":216,"column":19},"action":"remove","lines":["T"]},{"start":{"row":216,"column":17},"end":{"row":216,"column":18},"action":"remove","lines":["="]},{"start":{"row":216,"column":16},"end":{"row":216,"column":17},"action":"remove","lines":["g"]},{"start":{"row":216,"column":15},"end":{"row":216,"column":16},"action":"remove","lines":["u"]},{"start":{"row":216,"column":14},"end":{"row":216,"column":15},"action":"remove","lines":["b"]},{"start":{"row":216,"column":13},"end":{"row":216,"column":14},"action":"remove","lines":["e"]}],[{"start":{"row":214,"column":0},"end":{"row":216,"column":13},"action":"remove","lines":["","if __name__ == '__main__':","    app.run(d"],"id":724}],[{"start":{"row":143,"column":0},"end":{"row":155,"column":0},"action":"remove","lines":["import os","import boto3","from flask import Flask, render_template, request","","app = Flask(__name__)","","# S3 bucket configuration","S3_BUCKET_REGION = 'your_bucket_region'","S3_ACCESS_KEY = 'your_access_key'","S3_SECRET_ACCESS_KEY = 'your_secret_access_key'","S3_BUCKET_NAME = 'your_bucket_name'","S3_DIRECTORY_PREFIX = 'mojji-output-img'",""],"id":725}],[{"start":{"row":180,"column":55},"end":{"row":180,"column":69},"action":"remove","lines":["S3_BUCKET_NAME"],"id":726},{"start":{"row":180,"column":55},"end":{"row":180,"column":73},"action":"insert","lines":["'mojji-output-img'"]}],[{"start":{"row":189,"column":49},"end":{"row":189,"column":63},"action":"remove","lines":["S3_BUCKET_NAME"],"id":727},{"start":{"row":189,"column":49},"end":{"row":189,"column":67},"action":"insert","lines":["'mojji-output-img'"]}],[{"start":{"row":202,"column":0},"end":{"row":203,"column":0},"action":"insert","lines":["",""],"id":728}],[{"start":{"row":203,"column":0},"end":{"row":250,"column":0},"action":"insert","lines":["# @app.route('/user_check', methods=['GET'])","# def user_check():","#     # Get the value of identifier from the query parameters","#     identifier = request.args.get('identifier', '')","#     oauth_code = request.args.get('oauth_code', '')","#     directory_name_split = request.args.get('directory_name_split', '')","#     image_code = request.args.get('code', '')","#     file_names = request.args.get('file_names', '')","    ","#     prefix = 'after_detection_'","","#     # Define the base directory path","#     # base_directory = '/home/ubuntu/environment/efs/mojji-output-img/'","    ","#     directory_with_prefix = find_directory_with_prefix('/home/ubuntu/environment/efs/mojji-output-img/', prefix)","","#     if directory_with_prefix is None:","#         # If the directory with the prefix is not found, handle the error","#         return \"Directory with prefix '{}' not found.\".format(prefix)","","#     # Construct the full identifier with the directory name","#     full_identifier = os.path.join('/home/ubuntu/environment/efs/mojji-output-img/', directory_with_prefix)","","#     # full_identifier = os.path.join(base_directory, directory_name_split)","","#     object_names = []  # List to store the object names","    ","#     # Iterate over the files in the directory","#     for file_name in os.listdir(full_identifier):","#         object_names.append(file_name)","        ","#     # You can use the code to generate the S3 URL for the uploaded image","#     s3 = boto3.client(","#         service_name=\"s3\",","#         region_name=S3_BUCKET_REGION,","#         aws_access_key_id=S3_ACCESS_KEY,","#         aws_secret_access_key=S3_SECRET_ACCESS_KEY","#     )","","#     result_url = s3.generate_presigned_url(","#         'get_object',","#         Params={'Bucket': \"resultimg\", 'Key': image_code},","#         ExpiresIn=3600  # URL's expiration time in seconds","#     )","    ","#     # Pass the object names, directory name, and identifier to the template","#     return render_template('page5.html',code=image_code, object_names=object_names, directory_name=directory_name_split, identifier=identifier, oauth_code=oauth_code, result_url=result_url, full_identifier=full_identifier, file_names=file_names)",""],"id":729}],[{"start":{"row":203,"column":0},"end":{"row":203,"column":2},"action":"remove","lines":["# "],"id":730},{"start":{"row":204,"column":0},"end":{"row":204,"column":2},"action":"remove","lines":["# "]},{"start":{"row":205,"column":0},"end":{"row":205,"column":2},"action":"remove","lines":["# "]},{"start":{"row":206,"column":0},"end":{"row":206,"column":2},"action":"remove","lines":["# "]},{"start":{"row":207,"column":0},"end":{"row":207,"column":2},"action":"remove","lines":["# "]},{"start":{"row":208,"column":0},"end":{"row":208,"column":2},"action":"remove","lines":["# "]},{"start":{"row":209,"column":0},"end":{"row":209,"column":2},"action":"remove","lines":["# "]},{"start":{"row":210,"column":0},"end":{"row":210,"column":2},"action":"remove","lines":["# "]},{"start":{"row":212,"column":0},"end":{"row":212,"column":2},"action":"remove","lines":["# "]},{"start":{"row":214,"column":0},"end":{"row":214,"column":2},"action":"remove","lines":["# "]},{"start":{"row":215,"column":0},"end":{"row":215,"column":2},"action":"remove","lines":["# "]},{"start":{"row":217,"column":0},"end":{"row":217,"column":2},"action":"remove","lines":["# "]},{"start":{"row":219,"column":0},"end":{"row":219,"column":2},"action":"remove","lines":["# "]},{"start":{"row":220,"column":0},"end":{"row":220,"column":2},"action":"remove","lines":["# "]},{"start":{"row":221,"column":0},"end":{"row":221,"column":2},"action":"remove","lines":["# "]},{"start":{"row":223,"column":0},"end":{"row":223,"column":2},"action":"remove","lines":["# "]},{"start":{"row":224,"column":0},"end":{"row":224,"column":2},"action":"remove","lines":["# "]},{"start":{"row":226,"column":0},"end":{"row":226,"column":2},"action":"remove","lines":["# "]},{"start":{"row":228,"column":0},"end":{"row":228,"column":2},"action":"remove","lines":["# "]},{"start":{"row":230,"column":0},"end":{"row":230,"column":2},"action":"remove","lines":["# "]},{"start":{"row":231,"column":0},"end":{"row":231,"column":2},"action":"remove","lines":["# "]},{"start":{"row":232,"column":0},"end":{"row":232,"column":2},"action":"remove","lines":["# "]},{"start":{"row":234,"column":0},"end":{"row":234,"column":2},"action":"remove","lines":["# "]},{"start":{"row":235,"column":0},"end":{"row":235,"column":2},"action":"remove","lines":["# "]},{"start":{"row":236,"column":0},"end":{"row":236,"column":2},"action":"remove","lines":["# "]},{"start":{"row":237,"column":0},"end":{"row":237,"column":2},"action":"remove","lines":["# "]},{"start":{"row":238,"column":0},"end":{"row":238,"column":2},"action":"remove","lines":["# "]},{"start":{"row":239,"column":0},"end":{"row":239,"column":2},"action":"remove","lines":["# "]},{"start":{"row":240,"column":0},"end":{"row":240,"column":2},"action":"remove","lines":["# "]},{"start":{"row":242,"column":0},"end":{"row":242,"column":2},"action":"remove","lines":["# "]},{"start":{"row":243,"column":0},"end":{"row":243,"column":2},"action":"remove","lines":["# "]},{"start":{"row":244,"column":0},"end":{"row":244,"column":2},"action":"remove","lines":["# "]},{"start":{"row":245,"column":0},"end":{"row":245,"column":2},"action":"remove","lines":["# "]},{"start":{"row":246,"column":0},"end":{"row":246,"column":2},"action":"remove","lines":["# "]},{"start":{"row":248,"column":0},"end":{"row":248,"column":2},"action":"remove","lines":["# "]},{"start":{"row":249,"column":0},"end":{"row":249,"column":2},"action":"remove","lines":["# "]}],[{"start":{"row":203,"column":0},"end":{"row":222,"column":0},"action":"remove","lines":["@app.route('/user_check', methods=['GET'])","def user_check():","    # Get the value of identifier from the query parameters","    identifier = request.args.get('identifier', '')","    oauth_code = request.args.get('oauth_code', '')","    directory_name_split = request.args.get('directory_name_split', '')","    image_code = request.args.get('code', '')","    file_names = request.args.get('file_names', '')","    ","    prefix = 'after_detection_'","","    # Define the base directory path","    # base_directory = '/home/ubuntu/environment/efs/mojji-output-img/'","    ","    directory_with_prefix = find_directory_with_prefix('/home/ubuntu/environment/efs/mojji-output-img/', prefix)","","    if directory_with_prefix is None:","        # If the directory with the prefix is not found, handle the error","        return \"Directory with prefix '{}' not found.\".format(prefix)",""],"id":731},{"start":{"row":202,"column":0},"end":{"row":203,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":213,"column":0},"end":{"row":230,"column":0},"action":"remove","lines":["        ","    # You can use the code to generate the S3 URL for the uploaded image","    s3 = boto3.client(","        service_name=\"s3\",","        region_name=S3_BUCKET_REGION,","        aws_access_key_id=S3_ACCESS_KEY,","        aws_secret_access_key=S3_SECRET_ACCESS_KEY","    )","","    result_url = s3.generate_presigned_url(","        'get_object',","        Params={'Bucket': \"resultimg\", 'Key': image_code},","        ExpiresIn=3600  # URL's expiration time in seconds","    )","    ","    # Pass the object names, directory name, and identifier to the template","    return render_template('page5.html',code=image_code, object_names=object_names, directory_name=directory_name_split, identifier=identifier, oauth_code=oauth_code, result_url=result_url, full_identifier=full_identifier, file_names=file_names)",""],"id":732}],[{"start":{"row":203,"column":0},"end":{"row":212,"column":38},"action":"remove","lines":["    # Construct the full identifier with the directory name","    full_identifier = os.path.join('/home/ubuntu/environment/efs/mojji-output-img/', directory_with_prefix)","","    # full_identifier = os.path.join(base_directory, directory_name_split)","","    object_names = []  # List to store the object names","    ","    # Iterate over the files in the directory","    for file_name in os.listdir(full_identifier):","        object_names.append(file_name)"],"id":733},{"start":{"row":202,"column":0},"end":{"row":203,"column":0},"action":"remove","lines":["",""]},{"start":{"row":201,"column":105},"end":{"row":202,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":184,"column":69},"end":{"row":185,"column":0},"action":"insert","lines":["",""],"id":734},{"start":{"row":185,"column":0},"end":{"row":185,"column":8},"action":"insert","lines":["        "]},{"start":{"row":185,"column":8},"end":{"row":186,"column":0},"action":"insert","lines":["",""]},{"start":{"row":186,"column":0},"end":{"row":186,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":186,"column":4},"end":{"row":186,"column":8},"action":"remove","lines":["    "],"id":735}],[{"start":{"row":186,"column":4},"end":{"row":195,"column":38},"action":"insert","lines":["    # Construct the full identifier with the directory name","    full_identifier = os.path.join('/home/ubuntu/environment/efs/mojji-output-img/', directory_with_prefix)","","    # full_identifier = os.path.join(base_directory, directory_name_split)","","    object_names = []  # List to store the object names","    ","    # Iterate over the files in the directory","    for file_name in os.listdir(full_identifier):","        object_names.append(file_name)"],"id":736}],[{"start":{"row":186,"column":0},"end":{"row":186,"column":4},"action":"remove","lines":["    "],"id":737}],[{"start":{"row":186,"column":0},"end":{"row":196,"column":0},"action":"remove","lines":["    # Construct the full identifier with the directory name","    full_identifier = os.path.join('/home/ubuntu/environment/efs/mojji-output-img/', directory_with_prefix)","","    # full_identifier = os.path.join(base_directory, directory_name_split)","","    object_names = []  # List to store the object names","    ","    # Iterate over the files in the directory","    for file_name in os.listdir(full_identifier):","        object_names.append(file_name)",""],"id":738},{"start":{"row":185,"column":8},"end":{"row":186,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":187,"column":35},"end":{"row":187,"column":56},"action":"remove","lines":["directory_with_prefix"],"id":739},{"start":{"row":187,"column":35},"end":{"row":187,"column":55},"action":"insert","lines":["directory_name_split"]}],[{"start":{"row":187,"column":56},"end":{"row":188,"column":0},"action":"insert","lines":["",""],"id":740},{"start":{"row":188,"column":0},"end":{"row":188,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":188,"column":4},"end":{"row":188,"column":19},"action":"insert","lines":["full_identifier"],"id":741}],[{"start":{"row":188,"column":18},"end":{"row":188,"column":19},"action":"remove","lines":["r"],"id":742},{"start":{"row":188,"column":17},"end":{"row":188,"column":18},"action":"remove","lines":["e"]},{"start":{"row":188,"column":16},"end":{"row":188,"column":17},"action":"remove","lines":["i"]},{"start":{"row":188,"column":15},"end":{"row":188,"column":16},"action":"remove","lines":["f"]},{"start":{"row":188,"column":14},"end":{"row":188,"column":15},"action":"remove","lines":["i"]},{"start":{"row":188,"column":13},"end":{"row":188,"column":14},"action":"remove","lines":["t"]},{"start":{"row":188,"column":12},"end":{"row":188,"column":13},"action":"remove","lines":["n"]},{"start":{"row":188,"column":11},"end":{"row":188,"column":12},"action":"remove","lines":["e"]},{"start":{"row":188,"column":10},"end":{"row":188,"column":11},"action":"remove","lines":["d"]},{"start":{"row":188,"column":9},"end":{"row":188,"column":10},"action":"remove","lines":["i"]}],[{"start":{"row":188,"column":9},"end":{"row":188,"column":10},"action":"insert","lines":["d"],"id":743}],[{"start":{"row":188,"column":9},"end":{"row":188,"column":10},"action":"remove","lines":["d"],"id":744}],[{"start":{"row":188,"column":9},"end":{"row":188,"column":10},"action":"insert","lines":["d"],"id":745},{"start":{"row":188,"column":10},"end":{"row":188,"column":11},"action":"insert","lines":["i"]},{"start":{"row":188,"column":11},"end":{"row":188,"column":12},"action":"insert","lines":["r"]},{"start":{"row":188,"column":12},"end":{"row":188,"column":13},"action":"insert","lines":["e"]},{"start":{"row":188,"column":13},"end":{"row":188,"column":14},"action":"insert","lines":["c"]},{"start":{"row":188,"column":14},"end":{"row":188,"column":15},"action":"insert","lines":["t"]},{"start":{"row":188,"column":15},"end":{"row":188,"column":16},"action":"insert","lines":["o"]},{"start":{"row":188,"column":16},"end":{"row":188,"column":17},"action":"insert","lines":["r"]},{"start":{"row":188,"column":17},"end":{"row":188,"column":18},"action":"insert","lines":["y"]}],[{"start":{"row":188,"column":18},"end":{"row":188,"column":19},"action":"insert","lines":[" "],"id":746},{"start":{"row":188,"column":19},"end":{"row":188,"column":20},"action":"insert","lines":["="]}],[{"start":{"row":188,"column":20},"end":{"row":188,"column":21},"action":"insert","lines":[" "],"id":747}],[{"start":{"row":188,"column":21},"end":{"row":188,"column":22},"action":"insert","lines":["p"],"id":748},{"start":{"row":188,"column":22},"end":{"row":188,"column":23},"action":"insert","lines":["r"]},{"start":{"row":188,"column":23},"end":{"row":188,"column":24},"action":"insert","lines":["e"]},{"start":{"row":188,"column":24},"end":{"row":188,"column":25},"action":"insert","lines":["f"]},{"start":{"row":188,"column":25},"end":{"row":188,"column":26},"action":"insert","lines":["i"]},{"start":{"row":188,"column":26},"end":{"row":188,"column":27},"action":"insert","lines":["x"]}],[{"start":{"row":188,"column":27},"end":{"row":188,"column":28},"action":"insert","lines":[" "],"id":749},{"start":{"row":188,"column":28},"end":{"row":188,"column":29},"action":"insert","lines":["+"]}],[{"start":{"row":188,"column":29},"end":{"row":188,"column":30},"action":"insert","lines":[" "],"id":750}],[{"start":{"row":188,"column":30},"end":{"row":188,"column":45},"action":"insert","lines":["full_identifier"],"id":751}],[{"start":{"row":190,"column":69},"end":{"row":190,"column":84},"action":"remove","lines":["full_identifier"],"id":752},{"start":{"row":190,"column":69},"end":{"row":190,"column":83},"action":"insert","lines":["full_directory"]}],[{"start":{"row":202,"column":104},"end":{"row":202,"column":105},"action":"insert","lines":[","],"id":753}],[{"start":{"row":202,"column":105},"end":{"row":202,"column":106},"action":"insert","lines":[" "],"id":754}],[{"start":{"row":202,"column":106},"end":{"row":202,"column":120},"action":"insert","lines":["full_directory"],"id":755}],[{"start":{"row":202,"column":120},"end":{"row":202,"column":121},"action":"insert","lines":["="],"id":756}],[{"start":{"row":202,"column":121},"end":{"row":202,"column":135},"action":"insert","lines":["full_directory"],"id":757}],[{"start":{"row":203,"column":0},"end":{"row":204,"column":0},"action":"insert","lines":["",""],"id":758},{"start":{"row":204,"column":0},"end":{"row":205,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":204,"column":0},"end":{"row":213,"column":0},"action":"insert","lines":["def map_korean_to_english(category):","    if category in [\"short_sleeved_shirt\", \"long_sleeved_shirt\", \"vest\", \"sling\"]:","        return \"top\"","    elif category in [\"shorts\", \"trousers\", \"skirt\"]:","        return \"bottom\"","    elif category in [\"short_sleeved_outwear\", \"long_sleeved_outwear\"]:","        return \"outwear\"","    else:","        return \"dress\"",""],"id":759}],[{"start":{"row":213,"column":0},"end":{"row":214,"column":0},"action":"insert","lines":["",""],"id":760}],[{"start":{"row":214,"column":0},"end":{"row":223,"column":0},"action":"insert","lines":["def map_english_to_string(english_category):","    if english_category == \"top\":","        return \"상 의\"","    elif english_category == \"bottom\":","        return \"하 의\"","    elif english_category == \"outwear\":","        return \"아우터\"","    else:","        return \"드레스\"",""],"id":761}],[{"start":{"row":223,"column":0},"end":{"row":224,"column":0},"action":"insert","lines":["",""],"id":762}],[{"start":{"row":223,"column":0},"end":{"row":224,"column":0},"action":"remove","lines":["",""],"id":763},{"start":{"row":222,"column":20},"end":{"row":223,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":199,"column":0},"end":{"row":203,"column":0},"action":"remove","lines":["    # Pass the object names, directory name, and identifier to the template","    return render_template('page5.html', code=image_code, object_names=object_names,","                           directory_name=directory_name_split, identifier=identifier,","                           oauth_code=oauth_code, result_url=result_url, full_identifier=full_identifier, full_directory=full_directory)",""],"id":764}],[{"start":{"row":199,"column":0},"end":{"row":214,"column":0},"action":"insert","lines":["@app.route('/user_check', methods=['GET'])","def user_check():","    # ... (your existing code)","","    # Mapping Korean categories to English categories for each file_name","    english_categories = [map_korean_to_english(file_name) for file_name in object_names]","","    # Mapping English categories to Korean strings for each English category","    korean_strings = [map_english_to_string(english_category) for english_category in english_categories]","","    # Pass the object names, directory name, and identifier to the template","    return render_template('page5.html', code=image_code, object_names=object_names,","                           directory_name=directory_name_split, identifier=identifier,","                           oauth_code=oauth_code, result_url=result_url, full_identifier=full_identifier,","                           english_categories=english_categories, korean_strings=korean_strings)",""],"id":765}],[{"start":{"row":199,"column":0},"end":{"row":202,"column":0},"action":"remove","lines":["@app.route('/user_check', methods=['GET'])","def user_check():","    # ... (your existing code)",""],"id":766},{"start":{"row":198,"column":4},"end":{"row":199,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":197,"column":5},"end":{"row":198,"column":0},"action":"insert","lines":["",""],"id":767},{"start":{"row":198,"column":0},"end":{"row":198,"column":4},"action":"insert","lines":["    "]},{"start":{"row":198,"column":4},"end":{"row":199,"column":0},"action":"insert","lines":["",""]},{"start":{"row":199,"column":0},"end":{"row":199,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":199,"column":4},"end":{"row":203,"column":5},"action":"insert","lines":["    result_url = s3.generate_presigned_url(","        'get_object',","        Params={'Bucket': \"resultimg\", 'Key': image_code},","        ExpiresIn=3600  # URL's expiration time in seconds","    )"],"id":768}],[{"start":{"row":199,"column":0},"end":{"row":199,"column":4},"action":"remove","lines":["    "],"id":770},{"start":{"row":200,"column":0},"end":{"row":200,"column":4},"action":"remove","lines":["    "]},{"start":{"row":201,"column":0},"end":{"row":201,"column":4},"action":"remove","lines":["    "]},{"start":{"row":202,"column":0},"end":{"row":202,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":201,"column":23},"end":{"row":201,"column":32},"action":"remove","lines":["resultimg"],"id":771},{"start":{"row":201,"column":23},"end":{"row":201,"column":39},"action":"insert","lines":["mojji-output-img"]}],[{"start":{"row":201,"column":49},"end":{"row":201,"column":50},"action":"insert","lines":["ㅔ"],"id":772},{"start":{"row":201,"column":49},"end":{"row":201,"column":50},"action":"remove","lines":["ㅔ"]}],[{"start":{"row":201,"column":49},"end":{"row":201,"column":50},"action":"insert","lines":["p"],"id":773},{"start":{"row":201,"column":50},"end":{"row":201,"column":51},"action":"insert","lines":["r"]},{"start":{"row":201,"column":51},"end":{"row":201,"column":52},"action":"insert","lines":["e"]},{"start":{"row":201,"column":52},"end":{"row":201,"column":53},"action":"insert","lines":["f"]},{"start":{"row":201,"column":53},"end":{"row":201,"column":54},"action":"insert","lines":["i"]},{"start":{"row":201,"column":54},"end":{"row":201,"column":55},"action":"insert","lines":["x"]},{"start":{"row":201,"column":55},"end":{"row":201,"column":56},"action":"insert","lines":["|"]}],[{"start":{"row":201,"column":55},"end":{"row":201,"column":56},"action":"remove","lines":["|"],"id":774}],[{"start":{"row":201,"column":55},"end":{"row":201,"column":56},"action":"insert","lines":["+"],"id":775}],[{"start":{"row":199,"column":9},"end":{"row":199,"column":10},"action":"remove","lines":["t"],"id":776},{"start":{"row":199,"column":8},"end":{"row":199,"column":9},"action":"remove","lines":["l"]},{"start":{"row":199,"column":7},"end":{"row":199,"column":8},"action":"remove","lines":["u"]},{"start":{"row":199,"column":6},"end":{"row":199,"column":7},"action":"remove","lines":["s"]},{"start":{"row":199,"column":5},"end":{"row":199,"column":6},"action":"remove","lines":["e"]},{"start":{"row":199,"column":4},"end":{"row":199,"column":5},"action":"remove","lines":["r"]}],[{"start":{"row":199,"column":4},"end":{"row":199,"column":10},"action":"insert","lines":["output"],"id":777}],[{"start":{"row":215,"column":95},"end":{"row":215,"column":96},"action":"insert","lines":[","],"id":778}],[{"start":{"row":215,"column":96},"end":{"row":215,"column":97},"action":"insert","lines":[" "],"id":779}],[{"start":{"row":215,"column":97},"end":{"row":215,"column":107},"action":"insert","lines":["output_url"],"id":780}],[{"start":{"row":215,"column":107},"end":{"row":215,"column":108},"action":"insert","lines":["="],"id":781}],[{"start":{"row":215,"column":108},"end":{"row":215,"column":118},"action":"insert","lines":["output_url"],"id":782}],[{"start":{"row":215,"column":117},"end":{"row":215,"column":118},"action":"remove","lines":["l"],"id":784},{"start":{"row":215,"column":116},"end":{"row":215,"column":117},"action":"remove","lines":["r"]},{"start":{"row":215,"column":115},"end":{"row":215,"column":116},"action":"remove","lines":["u"]},{"start":{"row":215,"column":114},"end":{"row":215,"column":115},"action":"remove","lines":["_"]},{"start":{"row":215,"column":113},"end":{"row":215,"column":114},"action":"remove","lines":["t"]},{"start":{"row":215,"column":112},"end":{"row":215,"column":113},"action":"remove","lines":["u"]},{"start":{"row":215,"column":111},"end":{"row":215,"column":112},"action":"remove","lines":["p"]},{"start":{"row":215,"column":110},"end":{"row":215,"column":111},"action":"remove","lines":["t"]},{"start":{"row":215,"column":109},"end":{"row":215,"column":110},"action":"remove","lines":["u"]},{"start":{"row":215,"column":108},"end":{"row":215,"column":109},"action":"remove","lines":["o"]},{"start":{"row":215,"column":107},"end":{"row":215,"column":108},"action":"remove","lines":["="]},{"start":{"row":215,"column":106},"end":{"row":215,"column":107},"action":"remove","lines":["l"]},{"start":{"row":215,"column":105},"end":{"row":215,"column":106},"action":"remove","lines":["r"]},{"start":{"row":215,"column":104},"end":{"row":215,"column":105},"action":"remove","lines":["u"]},{"start":{"row":215,"column":103},"end":{"row":215,"column":104},"action":"remove","lines":["_"]},{"start":{"row":215,"column":102},"end":{"row":215,"column":103},"action":"remove","lines":["t"]},{"start":{"row":215,"column":101},"end":{"row":215,"column":102},"action":"remove","lines":["u"]},{"start":{"row":215,"column":100},"end":{"row":215,"column":101},"action":"remove","lines":["p"]},{"start":{"row":215,"column":99},"end":{"row":215,"column":100},"action":"remove","lines":["t"]},{"start":{"row":215,"column":98},"end":{"row":215,"column":99},"action":"remove","lines":["u"]},{"start":{"row":215,"column":97},"end":{"row":215,"column":98},"action":"remove","lines":["o"]},{"start":{"row":215,"column":96},"end":{"row":215,"column":97},"action":"remove","lines":[" "]},{"start":{"row":215,"column":95},"end":{"row":215,"column":96},"action":"remove","lines":[","]}],[{"start":{"row":198,"column":0},"end":{"row":203,"column":5},"action":"remove","lines":["    ","    output_url = s3.generate_presigned_url(","    'get_object',","    Params={'Bucket': \"mojji-output-img\", 'Key': prefix+image_code},","    ExpiresIn=3600  # URL's expiration time in seconds","    )"],"id":785},{"start":{"row":197,"column":5},"end":{"row":198,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":961,"column":0},"end":{"row":961,"column":2},"action":"insert","lines":["# "],"id":786,"ignore":true},{"start":{"row":962,"column":0},"end":{"row":962,"column":2},"action":"insert","lines":["# "]}],[{"start":{"row":961,"column":0},"end":{"row":961,"column":2},"action":"remove","lines":["# "],"id":787,"ignore":true},{"start":{"row":962,"column":0},"end":{"row":962,"column":2},"action":"remove","lines":["# "]}],[{"start":{"row":961,"column":0},"end":{"row":961,"column":2},"action":"insert","lines":["# "],"id":788,"ignore":true},{"start":{"row":962,"column":0},"end":{"row":962,"column":2},"action":"insert","lines":["# "]}],[{"start":{"row":962,"column":0},"end":{"row":962,"column":2},"action":"remove","lines":["# "],"id":789,"ignore":true}],[{"start":{"row":961,"column":0},"end":{"row":961,"column":2},"action":"remove","lines":["# "],"id":790,"ignore":true}],[{"start":{"row":754,"column":0},"end":{"row":787,"column":90},"action":"remove","lines":["import csv","from urllib.parse import unquote","import re","from flask import url_for, redirect","","@app.route('/save-csv-new', methods=['POST'])","def save_csv():","    identifier_param = request.args.get('identifier', '')","    data = request.get_json()","    oauth_code = session.get('oauth_code')","    encoded_uri = data.get('data')","","    # Sanitize the identifier to remove non-alphanumeric characters","    sanitized_identifier = re.sub(r'\\W+', '_', identifier_param)","","    directory = '/home/ubuntu/environment/efs/crawling_csv'","    if not os.path.exists(directory):","        os.makedirs(directory)","","    # Generate a unique filename using the sanitized identifier","    csv_filename = f\"{sanitized_identifier.rsplit('_', 1)[0]}.csv\"","    csv_path = os.path.join(directory, csv_filename)","","    with open(csv_path, 'w', newline='') as file:","        writer = csv.writer(file)","        decoded_uri = unquote(encoded_uri)","        rows = decoded_uri.splitlines()","        rows = [row.replace('data:text/csv;charset=utf-8,', '') for row in rows]","        for row in rows:","            values = row.split(',')","            writer.writerow(values)","","    # Use the sanitized identifier for redirection","    return redirect(url_for('result', identifier=identifier_param, oauth_code=oauth_code))"],"id":791}],[{"start":{"row":754,"column":0},"end":{"row":790,"column":0},"action":"insert","lines":["import csv","from urllib.parse import unquote","import re","from flask import url_for, redirect","","@app.route('/save-csv-new', methods=['POST'])","def save_csv():","    identifier_param = request.args.get('identifier', '')","    data = request.get_json()","    oauth_code = session.get('oauth_code')","    encoded_uri = data.get('data')","","    # Sanitize the identifier to remove non-alphanumeric characters","    sanitized_identifier = re.sub(r'\\W+', '_', identifier_param)","","    # Use the \"{{ directory_name }}\" for the directory path","    directory_name = \"{{ directory_name }}\"","    directory = os.path.join('/home/ubuntu/environment/efs', directory_name)","    if not os.path.exists(directory):","        os.makedirs(directory)","","    # Generate a unique filename using the sanitized identifier","    csv_filename = f\"{sanitized_identifier.rsplit('_', 1)[0]}.csv\"","    csv_path = os.path.join(directory, csv_filename)","","    with open(csv_path, 'w', newline='') as file:","        writer = csv.writer(file)","        decoded_uri = unquote(encoded_uri)","        rows = decoded_uri.splitlines()","        rows = [row.replace('data:text/csv;charset=utf-8,', '') for row in rows]","        for row in rows:","            values = row.split(',')","            writer.writerow(values)","","    # Use the sanitized identifier for redirection","    return redirect(url_for('result', identifier=sanitized_identifier, oauth_code=oauth_code))",""],"id":792}],[{"start":{"row":789,"column":92},"end":{"row":789,"column":93},"action":"insert","lines":[","],"id":793}],[{"start":{"row":789,"column":93},"end":{"row":789,"column":94},"action":"insert","lines":[" "],"id":794}],[{"start":{"row":789,"column":94},"end":{"row":789,"column":103},"action":"insert","lines":["directory"],"id":795}],[{"start":{"row":789,"column":103},"end":{"row":789,"column":104},"action":"insert","lines":["="],"id":796}],[{"start":{"row":789,"column":104},"end":{"row":789,"column":113},"action":"insert","lines":["directory"],"id":797}],[{"start":{"row":754,"column":0},"end":{"row":789,"column":115},"action":"remove","lines":["import csv","from urllib.parse import unquote","import re","from flask import url_for, redirect","","@app.route('/save-csv-new', methods=['POST'])","def save_csv():","    identifier_param = request.args.get('identifier', '')","    data = request.get_json()","    oauth_code = session.get('oauth_code')","    encoded_uri = data.get('data')","","    # Sanitize the identifier to remove non-alphanumeric characters","    sanitized_identifier = re.sub(r'\\W+', '_', identifier_param)","","    # Use the \"{{ directory_name }}\" for the directory path","    directory_name = \"{{ directory_name }}\"","    directory = os.path.join('/home/ubuntu/environment/efs', directory_name)","    if not os.path.exists(directory):","        os.makedirs(directory)","","    # Generate a unique filename using the sanitized identifier","    csv_filename = f\"{sanitized_identifier.rsplit('_', 1)[0]}.csv\"","    csv_path = os.path.join(directory, csv_filename)","","    with open(csv_path, 'w', newline='') as file:","        writer = csv.writer(file)","        decoded_uri = unquote(encoded_uri)","        rows = decoded_uri.splitlines()","        rows = [row.replace('data:text/csv;charset=utf-8,', '') for row in rows]","        for row in rows:","            values = row.split(',')","            writer.writerow(values)","","    # Use the sanitized identifier for redirection","    return redirect(url_for('result', identifier=sanitized_identifier, oauth_code=oauth_code, directory=directory))"],"id":802},{"start":{"row":754,"column":0},"end":{"row":787,"column":67},"action":"insert","lines":["","import csv","from urllib.parse import unquote","import re","from flask import url_for, redirect","","@app.route('/save-csv-new', methods=['POST'])","def save_csv():","    identifier_param = request.args.get('identifier', '')","    data = request.get_json()","    encoded_uri = data.get('data')","","    # Sanitize the identifier to remove non-alphanumeric characters","    sanitized_identifier = re.sub(r'\\W+', '_', identifier_param)","","    directory = '/home/ubuntu/environment/efs/crawling_csv'","    if not os.path.exists(directory):","        os.makedirs(directory)","","    # Generate a unique filename using the sanitized identifier","    csv_filename = f\"{sanitized_identifier.rsplit('_', 1)[0]}.csv\"","    csv_path = os.path.join(directory, csv_filename)","","    with open(csv_path, 'w', newline='') as file:","        writer = csv.writer(file)","        decoded_uri = unquote(encoded_uri)","        rows = decoded_uri.splitlines()","        rows = [row.replace('data:text/csv;charset=utf-8,', '') for row in rows]","        for row in rows:","            values = row.split(',')","            writer.writerow(values)","","    # Use the sanitized identifier for redirection","    return redirect(url_for('result', identifier=identifier_param))"]}],[{"start":{"row":764,"column":34},"end":{"row":765,"column":0},"action":"insert","lines":["",""],"id":803},{"start":{"row":765,"column":0},"end":{"row":765,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":765,"column":4},"end":{"row":765,"column":71},"action":"insert","lines":["directory_name_split = request.args.get('directory_name_split', '')"],"id":804}],[{"start":{"row":775,"column":59},"end":{"row":775,"column":60},"action":"remove","lines":["]"],"id":805},{"start":{"row":775,"column":58},"end":{"row":775,"column":59},"action":"remove","lines":["0"]},{"start":{"row":775,"column":57},"end":{"row":775,"column":58},"action":"remove","lines":["["]},{"start":{"row":775,"column":56},"end":{"row":775,"column":57},"action":"remove","lines":[")"]},{"start":{"row":775,"column":55},"end":{"row":775,"column":56},"action":"remove","lines":["1"]},{"start":{"row":775,"column":54},"end":{"row":775,"column":55},"action":"remove","lines":[" "]},{"start":{"row":775,"column":53},"end":{"row":775,"column":54},"action":"remove","lines":[","]},{"start":{"row":775,"column":52},"end":{"row":775,"column":53},"action":"remove","lines":["'"]},{"start":{"row":775,"column":51},"end":{"row":775,"column":52},"action":"remove","lines":["_"]},{"start":{"row":775,"column":50},"end":{"row":775,"column":51},"action":"remove","lines":["'"]},{"start":{"row":775,"column":49},"end":{"row":775,"column":50},"action":"remove","lines":["("]},{"start":{"row":775,"column":48},"end":{"row":775,"column":49},"action":"remove","lines":["t"]},{"start":{"row":775,"column":47},"end":{"row":775,"column":48},"action":"remove","lines":["i"]},{"start":{"row":775,"column":46},"end":{"row":775,"column":47},"action":"remove","lines":["l"]},{"start":{"row":775,"column":45},"end":{"row":775,"column":46},"action":"remove","lines":["p"]},{"start":{"row":775,"column":44},"end":{"row":775,"column":45},"action":"remove","lines":["s"]},{"start":{"row":775,"column":43},"end":{"row":775,"column":44},"action":"remove","lines":["r"]},{"start":{"row":775,"column":42},"end":{"row":775,"column":43},"action":"remove","lines":["."]},{"start":{"row":775,"column":41},"end":{"row":775,"column":42},"action":"remove","lines":["r"]},{"start":{"row":775,"column":40},"end":{"row":775,"column":41},"action":"remove","lines":["e"]},{"start":{"row":775,"column":39},"end":{"row":775,"column":40},"action":"remove","lines":["i"]},{"start":{"row":775,"column":38},"end":{"row":775,"column":39},"action":"remove","lines":["f"]},{"start":{"row":775,"column":37},"end":{"row":775,"column":38},"action":"remove","lines":["i"]},{"start":{"row":775,"column":36},"end":{"row":775,"column":37},"action":"remove","lines":["t"]},{"start":{"row":775,"column":35},"end":{"row":775,"column":36},"action":"remove","lines":["n"]},{"start":{"row":775,"column":34},"end":{"row":775,"column":35},"action":"remove","lines":["e"]},{"start":{"row":775,"column":33},"end":{"row":775,"column":34},"action":"remove","lines":["d"]},{"start":{"row":775,"column":32},"end":{"row":775,"column":33},"action":"remove","lines":["i"]},{"start":{"row":775,"column":31},"end":{"row":775,"column":32},"action":"remove","lines":["_"]},{"start":{"row":775,"column":30},"end":{"row":775,"column":31},"action":"remove","lines":["d"]},{"start":{"row":775,"column":29},"end":{"row":775,"column":30},"action":"remove","lines":["e"]},{"start":{"row":775,"column":28},"end":{"row":775,"column":29},"action":"remove","lines":["z"]},{"start":{"row":775,"column":27},"end":{"row":775,"column":28},"action":"remove","lines":["i"]},{"start":{"row":775,"column":26},"end":{"row":775,"column":27},"action":"remove","lines":["t"]},{"start":{"row":775,"column":25},"end":{"row":775,"column":26},"action":"remove","lines":["i"]},{"start":{"row":775,"column":24},"end":{"row":775,"column":25},"action":"remove","lines":["n"]},{"start":{"row":775,"column":23},"end":{"row":775,"column":24},"action":"remove","lines":["a"]},{"start":{"row":775,"column":22},"end":{"row":775,"column":23},"action":"remove","lines":["s"]}],[{"start":{"row":775,"column":22},"end":{"row":775,"column":42},"action":"insert","lines":["directory_name_split"],"id":806}],[{"start":{"row":775,"column":47},"end":{"row":775,"column":48},"action":"remove","lines":["\""],"id":807}],[{"start":{"row":775,"column":42},"end":{"row":775,"column":43},"action":"remove","lines":["}"],"id":808}],[{"start":{"row":775,"column":21},"end":{"row":775,"column":22},"action":"remove","lines":["{"],"id":809},{"start":{"row":775,"column":20},"end":{"row":775,"column":21},"action":"remove","lines":["\""]},{"start":{"row":775,"column":19},"end":{"row":775,"column":20},"action":"remove","lines":["f"]},{"start":{"row":775,"column":18},"end":{"row":775,"column":19},"action":"remove","lines":[" "]}],[{"start":{"row":775,"column":18},"end":{"row":775,"column":19},"action":"insert","lines":[" "],"id":810}],[{"start":{"row":775,"column":39},"end":{"row":775,"column":40},"action":"remove","lines":["."],"id":811}],[{"start":{"row":775,"column":39},"end":{"row":775,"column":40},"action":"insert","lines":[" "],"id":812},{"start":{"row":775,"column":40},"end":{"row":775,"column":41},"action":"insert","lines":["+"]}],[{"start":{"row":775,"column":41},"end":{"row":775,"column":42},"action":"insert","lines":[" "],"id":813},{"start":{"row":775,"column":42},"end":{"row":775,"column":43},"action":"insert","lines":["'"]},{"start":{"row":775,"column":43},"end":{"row":775,"column":44},"action":"insert","lines":["."]}],[{"start":{"row":775,"column":47},"end":{"row":775,"column":48},"action":"insert","lines":["'"],"id":814}]]},"ace":{"folds":[],"scrolltop":12108.45556640625,"scrollleft":0,"selection":{"start":{"row":775,"column":48},"end":{"row":775,"column":48},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":755,"state":"start","mode":"ace/mode/python"}},"timestamp":1690175891628,"hash":"fbd629199bd9cc81c8a246613a62daf64ed924fd"}